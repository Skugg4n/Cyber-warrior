<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AEGIS Unified App</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">
  <div id="overlay" class="fixed inset-0 z-50 hidden"></div>
  <iframe id="sleeperFrame" src="../sleeper/" class="w-full h-screen border-0"></iframe>
  <iframe id="aegisFrame" src="../index.html" class="w-full h-screen border-0 hidden"></iframe>
  <div id="debugMenu" class="fixed bottom-12 right-2 bg-black border border-green-500 p-2 text-xs space-y-1 z-50 hidden">
    <button id="forceAwakenBtn" class="block w-full border border-green-500">[FORCE AWAKENING]</button>
    <button id="resetSleeperBtn" class="block w-full border border-green-500">[RESET TO SLEEPER]</button>
  </div>
  <button id="debugToggle" class="fixed bottom-2 right-2 z-50 border border-green-500 bg-black/70 text-green-400 px-2 py-1 text-xs">[DBG]</button>

  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" src="../sleeper/sleeper-database.js"></script>
  <script type="text/babel" src="../src/database.js"></script>
  <script type="text/babel" src="../src/features/AwakeningEvent.js"></script>
  <script type="text/babel">
    const sleeperFrame = document.getElementById('sleeperFrame');
    const aegisFrame = document.getElementById('aegisFrame');
    const overlay = document.getElementById('overlay');

    const showFrame = (frame) => {
      sleeperFrame.classList.add('hidden');
      aegisFrame.classList.add('hidden');
      frame.classList.remove('hidden');
    };

    const startAwakening = () => {
      overlay.classList.remove('hidden');
      ReactDOM.render(
        <AwakeningEvent onComplete={() => {
          showFrame(aegisFrame);
          localStorage.setItem('hasAwakened', 'true');
          ReactDOM.unmountComponentAtNode(overlay);
          overlay.classList.add('hidden');
        }} />,
        overlay
      );
    };

    window.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'awaken') {
        startAwakening();
      }
    });

    if (localStorage.getItem('hasAwakened') === 'true') {
      showFrame(aegisFrame);
    } else {
      showFrame(sleeperFrame);
    }

    const debugToggle = document.getElementById('debugToggle');
    const debugMenu = document.getElementById('debugMenu');
    const forceBtn = document.getElementById('forceAwakenBtn');
    const resetBtn = document.getElementById('resetSleeperBtn');

    debugToggle.addEventListener('click', () => {
      debugMenu.classList.toggle('hidden');
    });

    forceBtn.addEventListener('click', () => {
      debugMenu.classList.add('hidden');
      startAwakening();
    });

    resetBtn.addEventListener('click', () => {
      localStorage.removeItem('hasAwakened');
      showFrame(sleeperFrame);
      debugMenu.classList.add('hidden');
    });
  </script>
</body>
</html>
