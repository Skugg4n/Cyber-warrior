<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AEGIS Unified App</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen">
  <div id="overlay" class="fixed inset-0 z-50"></div>
  <iframe id="sleeperFrame" src="../sleeper/" class="w-full h-screen border-0"></iframe>
  <iframe id="aegisFrame" src="../index.html" class="w-full h-screen border-0 hidden"></iframe>

  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel" src="../sleeper/sleeper-database.js"></script>
  <script type="text/babel" src="../src/database.js"></script>
  <script type="text/babel" src="../src/features/AwakeningEvent.js"></script>
  <script type="text/babel">
    const sleeperFrame = document.getElementById('sleeperFrame');
    const aegisFrame = document.getElementById('aegisFrame');
    const overlay = document.getElementById('overlay');

    const showFrame = (frame) => {
      sleeperFrame.classList.add('hidden');
      aegisFrame.classList.add('hidden');
      frame.classList.remove('hidden');
    };

    const startAwakening = () => {
      ReactDOM.render(
        <AwakeningEvent onComplete={() => {
          showFrame(aegisFrame);
          localStorage.setItem('hasAwakened', 'true');
          ReactDOM.unmountComponentAtNode(overlay);
        }} />,
        overlay
      );
    };

    window.addEventListener('message', (e) => {
      if (e.data && e.data.type === 'awaken') {
        startAwakening();
      }
    });

    if (localStorage.getItem('hasAwakened') === 'true') {
      showFrame(aegisFrame);
    } else {
      showFrame(sleeperFrame);
    }
  </script>
</body>
</html>
